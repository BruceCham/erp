var app = angular.module('h5_angularjs', ['ui.router','ngDialog']);
app.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider) {
  $urlRouterProvider.otherwise('/login');
  $stateProvider
    .state('login',{
        url: '/login',
        templateUrl: '/static/app/view/login.html',
        controller: 'loginController'
    })
    .state('reg',{
        url: '/reg',
        templateUrl: '/static/app/view/reg.html',
        controller: 'regController'
    })
    .state('home',{
        url: '/home',
        templateUrl: '/static/app/view/home.html',
        controller: 'homeController'
    })
    .state('error{code}',{
        url: '/error/:code',
        templateUrl: '/static/app/view/error.html',
        controller: ["$scope","$routeParams",function($scope,$routeParams){
            $scope.errorCode = $routeParams.code;
        }]
    });
  }
]);
app.controller('homeController',['$scope','$http','$state',function($scope,$http,$state){
	$http({
		url: '/Res/getAllRes',
		method: 'post'
	}).success(function(res){
		console.log(res);
	});
	$scope.logout = function(){
		$http({
			url: '/User/logout',
			method: 'get'
		}).success(function(res){
			if( res.resultCode == '000000' ){
				alert('退出成功');
				$state.go('login');
			}else{
				alert(res.resultMsg);
			}
		});
	}
}])
app.controller('loginController', ['$scope','$http','$state','$rootScope',function($scope,$http,$state,$rootScope){
    $scope.login = function(flag){
        if( flag ){
            $http({
                url: '/User/login',
                method: 'post',
                data: {
                    phone: $scope.phone,
                    password: $scope.password
                }
            }).success(function(res){
                if(res.resultCode == '000000'){
                    alert('登录成功');
                    $rootScope.username = res.result.username;
                    $state.go('home');
                }else{
                    alert(res.resultMsg);
                    $rootScope.username = res.result.username;
                    $state.go('home');
                }
            })
        }
    }
}])
app.controller('regController', ['$scope','$http','$state','$rootScope', function($scope,$http,$state,$rootScope){
    $scope.reg = function(flag){
        if( flag ){
            $http({
                url: '/User/reg',
                method: 'post',
                data: {
                	name: $scope.name,
                    phone: $scope.phone,
                    password: $scope.password,
                    passwordRepeat: $scope.passwordRepeat
                }
            }).success(function(res){
                if( res.resultCode == '000000' ){
                    alert('注册成功');
                    $rootScope.username = res.result.username;
                    $state.go('home');
                }else{
                    alert(res.resultMsg)
                }
            })
        }
    }
}])