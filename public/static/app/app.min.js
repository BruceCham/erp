var appUnlogin = angular.module('unlogin_h5', ['ui.router']);
appUnlogin.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider) {
  $urlRouterProvider.otherwise('/login');
  $stateProvider
    .state('login',{
        url: '/login',
        templateUrl: '/static/app/view/login.html',
        controller: 'loginController'
    })
    .state('reg',{
        url: '/reg',
        templateUrl: '/static/app/view/reg.html',
        controller: 'regController'
    })
  }
]);
var appLogin = angular.module('login_h5',['ui.router']);
appLogin.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){
    $urlRouterProvider.otherwise('/home');
    $stateProvider
    .state('home',{
        url: '/home',
        templateUrl: '/static/app/view/home.html',
        controller: 'homeController'
    })
    .state('class',{
        url: '/class/:ctns',
        templateUrl: '/static/app/view/class.html',
        controller: 'classController'
    })
}]);
appLogin.controller('classController',['$scope','$http','$stateParams',function($scope,$http,$stateParams){
	$scope.dataArr = [];
	$http({
		url: '/Res/getAllResByClass',
		params:{
			ctns: $stateParams.ctns.toString()
		},
		method: 'get'
	}).success(function(res){
		if(res.resultCode == '000000'){
			$scope.dataArr = res.result;
		}
	});
}]);
appLogin.controller('homeController',['$scope','$http','$rootScope',function($scope,$http,$rootScope){
	$scope.classData = [];
	$http({
		url: '/Res/getAllRes'
	}).success(function(res){
		$scope.classData = res.result;
	});
	$rootScope.logout = function(){
		$http({
			url: '/User/logout',
			method: 'get'
		}).success(function(res){
			if( res.resultCode == '000000' ){
				alert('退出成功');
				location.reload();
			}else{
				alert(res.resultMsg);
			}
		});
	}
}]);
appUnlogin.controller('loginController', ['$scope','$http',function($scope,$http){
    $scope.login = function(flag){
        if( flag ){
            $http({
                url: '/User/login',
                method: 'post',
                data: {
                    phone: $scope.phone,
                    password: $scope.password
                }
            }).success(function(res){
                if(res.resultCode == '000000'){
                    alert('登录成功');
                    location.reload();
                }else{
                    alert(res.resultMsg);
                }
            })
        }
    }
}])
appUnlogin.controller('regController', ['$scope','$http','$state', function($scope,$http,$state){
    $scope.reg = function(flag){
        if( flag ){
            $http({
                url: '/User/reg',
                method: 'post',
                data: {
                	name: $scope.name,
                    phone: $scope.phone,
                    password: $scope.password,
                    passwordRepeat: $scope.passwordRepeat
                }
            }).success(function(res){
                if( res.resultCode == '000000' ){
                    alert('注册成功');
                    $state.go('login');
                }else{
                    alert(res.resultMsg)
                }
            })
        }
    }
}])