var appUnlogin = angular.module('unlogin_h5', ['ui.router']);
appUnlogin.config(["$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider) {
    $urlRouterProvider.otherwise('/login');
    $stateProvider
        .state('login', {
            url: '/login',
            templateUrl: '/static/app/view/login.html',
            controller: 'loginController'
        })
        .state('reg', {
            url: '/reg',
            templateUrl: '/static/app/view/reg.html',
            controller: 'regController'
        })
}]);
var appLogin = angular.module('login_h5', ['ui.router']);
appLogin.config(["$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider) {
    $urlRouterProvider.otherwise('/home');
    $stateProvider
        .state('home', {
            url: '/home',
            templateUrl: '/static/app/view/home.html',
            controller: 'homeController'
        })
        .state('home.info', {
            url: '/info',
            templateUrl: '/static/app/view/home.info.html',
            controller: 'homeInfoController'
        })
        .state('home.list', {
            url: '/list',
            templateUrl: '/static/app/view/home.list.html',
            controller: 'homeListController'
        })
        .state('home.class', {
            url: '/class/:ctn',
            templateUrl: '/static/app/view/home.class.html',
            controller: 'homeClassController'
        })
}]);

appLogin.controller('homeClassController',['$scope','$http','$stateParams',function($scope,$http,$stateParams){
	$scope.dataArr = [];
	$scope.activeCSindex = null;//null 不显示，非null 显示
	$scope.showResDetail = function(o){
		$scope.activeCSindex = o.cs;
		$scope.sn = o.sn || o.cs;
		$scope.sp = o.sp;
		$scope.op = o.op;
		$scope.ctns = o.ctns;
		$scope.byMe = o.byMe;
		$scope.isDisable = o.op && !o.byMe;
	}
	$scope.putRes = function(flag){
		if( flag ){
			$http({
				url: '/Res/updateResByCtns',
				method: 'post',
				data: {
					sn: $scope.sn,
					sp: $scope.sp,
					ctns: $scope.ctns
				}
			}).success(function(res){
				if( res.resultCode == '000000' ){
					alert('操作成功');
					location.reload();
				}else{
					alert( res.resultMsg );
				}
			})
		}
	}
	$http({
		url: '/Res/getAllResByClass',
		params:{
			ctn: $stateParams.ctn.toString()
		},
		method: 'get'
	}).success(function(res){
		if(res.resultCode == '000000'){
			$scope.dataArr = res.result;
			var o = $scope.dataArr[0];
			$scope.activeCSindex = o.cs;
			$scope.sn = o.sn || o.cs;
			$scope.sp = o.sp;
			$scope.op = o.op;
			$scope.ctns = o.ctns;
			$scope.byMe = o.byMe;
			$scope.isDisable = o.op && !o.byMe;
		}
	});
}]);
appLogin.controller('homeController',['$scope','$http','$rootScope',function($scope,$http,$rootScope){
	$scope.classData = [];
	$rootScope.logout = function(){
		$http({
			url: '/User/logout',
			method: 'get'
		}).success(function(res){
			if( res.resultCode == '000000' ){
				alert('退出成功');
				location.reload();
			}else{
				alert(res.resultMsg);
			}
		});
	}
}]);
appLogin.controller('homeInfoController', ['$scope', function($scope){
		
}])
appLogin.controller('homeListController',['$scope','$http','$rootScope',function($scope,$http,$rootScope){
	$scope.classData = [];
	$http({
		url: '/Res/getAllRes'
	}).success(function(res){
		$scope.classData = res.result;
	});
}]);
appUnlogin.controller('loginController', ['$scope','$http',function($scope,$http){
    $scope.login = function(flag){
        if( flag ){
            $http({
                url: '/User/login',
                method: 'post',
                data: {
                    phone: $scope.phone,
                    password: $scope.password
                }
            }).success(function(res){
                if(res.resultCode == '000000'){
                    alert('登录成功');
                    location.reload();
                }else{
                    alert(res.resultMsg);
                }
            })
        }
    }
}])
appUnlogin.controller('regController', ['$scope','$http','$state', function($scope,$http,$state){
    $scope.reg = function(flag){
        if( flag ){
            $http({
                url: '/User/reg',
                method: 'post',
                data: {
                	name: $scope.name,
                    phone: $scope.phone,
                    password: $scope.password,
                    passwordRepeat: $scope.passwordRepeat
                }
            }).success(function(res){
                if( res.resultCode == '000000' ){
                    alert('注册成功');
                    $state.go('login');
                }else{
                    alert(res.resultMsg)
                }
            })
        }
    }
}])